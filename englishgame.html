<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>English Master - U1-U6</title>
    <style>
        :root {
            --bg-color: #0f172a;
            --card-bg: rgba(30, 41, 59, 0.7);
            --primary: #3b82f6;
            --accent: #8b5cf6;
            --success: #10b981;
            --error: #ef4444;
            --text-main: #f8fafc;
            --text-sub: #94a3b8;
            --glass: blur(12px);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-color);
            background-image: radial-gradient(circle at 10% 20%, rgba(59, 130, 246, 0.1) 0%, transparent 20%),
                              radial-gradient(circle at 90% 80%, rgba(139, 92, 246, 0.1) 0%, transparent 20%);
            color: var(--text-main);
            margin: 0;
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        /* --- Header & Stats --- */
        header {
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(15, 23, 42, 0.8);
            backdrop-filter: var(--glass);
            border-bottom: 1px solid rgba(255,255,255,0.05);
            z-index: 10;
        }

        .brand {
            font-weight: 800;
            font-size: 1.2rem;
            background: linear-gradient(to right, var(--primary), var(--accent));
            -webkit-background-clip: text;
            color: transparent;
            letter-spacing: -0.5px;
        }

        .stats-bar {
            display: flex;
            gap: 15px;
            font-size: 0.9rem;
            font-weight: 600;
        }

        .stat-item {
            display: flex;
            align-items: center;
            gap: 5px;
            background: rgba(255,255,255,0.05);
            padding: 5px 12px;
            border-radius: 20px;
        }

        .xp-text { color: var(--accent); }
        .level-text { color: var(--primary); }

        /* --- Progress Bar --- */
        .progress-container {
            width: 100%;
            height: 4px;
            background: rgba(255,255,255,0.1);
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--accent));
            width: 0%;
            transition: width 0.5s ease;
            box-shadow: 0 0 10px var(--primary);
        }

        /* --- Main Layout --- */
        .app-container {
            flex: 1;
            display: flex;
            overflow: hidden;
            position: relative;
        }

        /* Sidebar Navigation */
        .sidebar {
            width: 80px;
            background: rgba(15, 23, 42, 0.5);
            display: flex;
            flex-direction: column;
            align-items: center;
            padding-top: 20px;
            border-right: 1px solid rgba(255,255,255,0.05);
        }

        .nav-item {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.5rem;
            cursor: pointer;
            margin-bottom: 20px;
            color: var(--text-sub);
            transition: all 0.2s;
        }

        .nav-item:hover, .nav-item.active {
            background: rgba(255,255,255,0.1);
            color: var(--text-main);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }

        /* Content Area */
        .content-area {
            flex: 1;
            padding: 30px;
            overflow-y: auto;
            display: flex;
            justify-content: center;
            align-items: flex-start;
        }

        /* --- Views --- */
        .view { display: none; width: 100%; max-width: 800px; animation: fadeIn 0.4s ease; }
        .view.active { display: block; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* Dashboard */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }

        .unit-card {
            background: var(--card-bg);
            border: 1px solid rgba(255,255,255,0.05);
            border-radius: 16px;
            padding: 20px;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            position: relative;
            overflow: hidden;
        }

        .unit-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.3);
            border-color: rgba(59, 130, 246, 0.3);
        }

        .unit-card h3 { margin: 0 0 10px 0; font-size: 1.1rem; }
        .unit-card p { margin: 0; color: var(--text-sub); font-size: 0.85rem; }
        .unit-progress-bar {
            margin-top: 15px;
            height: 6px;
            background: rgba(0,0,0,0.3);
            border-radius: 3px;
        }
        .unit-progress-fill { height: 100%; border-radius: 3px; background: var(--success); width: 0%; }

        /* Game/Quiz Mode */
        .game-container {
            background: var(--card-bg);
            backdrop-filter: var(--glass);
            border-radius: 24px;
            padding: 40px;
            text-align: center;
            box-shadow: 0 20px 50px rgba(0,0,0,0.3);
            border: 1px solid rgba(255,255,255,0.05);
            position: relative;
        }

        .combo-counter {
            position: absolute;
            top: -20px;
            right: -20px;
            background: linear-gradient(135deg, #f59e0b, #d97706);
            padding: 10px 20px;
            border-radius: 20px;
            font-weight: 900;
            font-size: 1.2rem;
            transform: rotate(5deg);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            opacity: 0;
            transition: opacity 0.3s;
        }

        .question-text {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 40px;
            min-height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .options-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .option-btn {
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            color: var(--text-main);
            padding: 20px;
            border-radius: 12px;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
            overflow: hidden;
        }

        .option-btn:hover {
            background: rgba(255,255,255,0.1);
            transform: scale(1.02);
        }

        .option-btn.correct { background: rgba(16, 185, 129, 0.2); border-color: var(--success); color: var(--success); }
        .option-btn.wrong { background: rgba(239, 68, 68, 0.2); border-color: var(--error); color: var(--error); }

        /* Badges/Profile */
        .badge-grid { display: flex; flex-wrap: wrap; gap: 15px; justify-content: center; }
        .badge {
            background: rgba(0,0,0,0.2);
            padding: 10px 20px;
            border-radius: 12px;
            border: 1px solid rgba(255,255,255,0.05);
            opacity: 0.5;
            filter: grayscale(1);
            transition: 0.3s;
        }
        .badge.unlocked { opacity: 1; filter: grayscale(0); border-color: var(--accent); background: rgba(139, 92, 246, 0.1); }
        .badge-icon { font-size: 2rem; display: block; margin-bottom: 5px; }

        /* Particles */
        .particle {
            position: absolute;
            pointer-events: none;
            animation: pop 0.8s ease-out forwards;
        }
        @keyframes pop {
            0% { opacity: 1; transform: translate(0, 0) scale(1); }
            100% { opacity: 0; transform: translate(var(--x), var(--y)) scale(0); }
        }
        
        /* Mobile Responsive */
        @media (max-width: 768px) {
            .app-container { flex-direction: column-reverse; }
            .sidebar { width: 100%; height: 60px; flex-direction: row; justify-content: space-around; padding-top: 0; border-right: none; border-top: 1px solid rgba(255,255,255,0.1); }
            .nav-item { margin-bottom: 0; }
            .options-grid { grid-template-columns: 1fr; }
            .question-text { font-size: 1.8rem; }
        }

    </style>
</head>
<body>

<header>
    <div class="brand">AiWind.Edu</div>
    <div class="stats-bar">
        <div class="stat-item" title="å½“å‰ç­‰çº§">
            <span>ğŸ†</span> <span class="level-text" id="displayLevel">Lv.1</span>
        </div>
        <div class="stat-item" title="æ€»ç»éªŒå€¼">
            <span>âš¡</span> <span class="xp-text" id="displayXP">0 XP</span>
        </div>
    </div>
</header>
<div class="progress-container"><div class="progress-fill" id="overallProgress"></div></div>

<div class="app-container">
    <nav class="sidebar">
        <div class="nav-item active" onclick="switchView('dashboard')" title="ä¸»é¡µ">ğŸ </div>
        <div class="nav-item" onclick="switchView('game')" title="æŒ‘æˆ˜">âš”ï¸</div>
        <div class="nav-item" onclick="switchView('profile')" title="æˆå°±">ğŸ…</div>
    </nav>

    <div class="content-area">
        
        <div id="view-dashboard" class="view active">
            <h2 style="margin-bottom:25px;">é€‰æ‹©ä»»åŠ¡ (Select Mission)</h2>
            <div class="dashboard-grid">
                <div class="unit-card" onclick="startGame(1)">
                    <h3>U1: Water</h3>
                    <p>æ°´èµ„æºä¸ä¿æŠ¤</p>
                    <div class="unit-progress-bar"><div class="unit-progress-fill" style="width:0%" id="prog-1"></div></div>
                </div>
                <div class="unit-card" onclick="startGame(2)">
                    <h3>U2: Digital Life</h3>
                    <p>æ•°å­—ç”Ÿæ´»ä¸ç§‘æŠ€</p>
                    <div class="unit-progress-bar"><div class="unit-progress-fill" style="width:0%" id="prog-2"></div></div>
                </div>
                <div class="unit-card" onclick="startGame(3)">
                    <h3>U3: Curious Mind</h3>
                    <p>å¥½å¥‡å¿ƒä¸ç§‘å­¦æ¢ç´¢</p>
                    <div class="unit-progress-bar"><div class="unit-progress-fill" style="width:0%" id="prog-3"></div></div>
                </div>
                <div class="unit-card" onclick="startGame(4)">
                    <h3>U4: Then and Now</h3>
                    <p>å†å²å˜è¿ä¸å¯¹æ¯”</p>
                    <div class="unit-progress-bar"><div class="unit-progress-fill" style="width:0%" id="prog-4"></div></div>
                </div>
                <div class="unit-card" onclick="startGame(5)">
                    <h3>U5: Teamwork</h3>
                    <p>å›¢é˜Ÿåˆä½œ</p>
                    <div class="unit-progress-bar"><div class="unit-progress-fill" style="width:0%" id="prog-5"></div></div>
                </div>
                <div class="unit-card" onclick="startGame(6)">
                    <h3>U6: Future Life</h3>
                    <p>æœªæ¥ç”Ÿæ´»ç•…æƒ³</p>
                    <div class="unit-progress-bar"><div class="unit-progress-fill" style="width:0%" id="prog-6"></div></div>
                </div>
                <div class="unit-card" onclick="startGame('all')" style="border-color: var(--accent);">
                    <h3 style="color:var(--accent)">ğŸš€ Total Review</h3>
                    <p>å…¨ä¹¦ç»¼åˆå¤§æŒ‘æˆ˜</p>
                    <div class="unit-progress-bar"><div class="unit-progress-fill" style="width:0%" id="prog-all"></div></div>
                </div>
            </div>
        </div>

        <div id="view-game" class="view">
            <div class="game-container">
                <div class="combo-counter" id="comboBadge">COMBO x2!</div>
                <div style="color:var(--text-sub); margin-bottom:10px;" id="gameUnitLabel">UNIT 1</div>
                
                <div class="question-text" id="questionText">Loading...</div>
                
                <div class="options-grid" id="optionsGrid">
                    </div>
                
                <div style="margin-top: 30px; font-size: 0.9rem; color: var(--text-sub);">
                    <span id="qCurrent">1</span> / <span id="qTotal">10</span>
                </div>
            </div>
            <button onclick="switchView('dashboard')" style="margin-top:20px; background:none; border:none; color:var(--text-sub); cursor:pointer; text-decoration:underline;">é€€å‡ºæŒ‘æˆ˜ (Exit)</button>
        </div>

        <div id="view-profile" class="view">
            <h2 style="text-align:center; margin-bottom:10px;">æˆ‘çš„æˆå°± (My Achievements)</h2>
            <div style="text-align:center; margin-bottom:30px;">
                <h1 style="font-size:3rem; margin:0;" id="profileLevel">Lv.1</h1>
                <p style="color:var(--text-sub);">Current Rank: Novice</p>
            </div>
            
            <div class="badge-grid">
                <div class="badge" id="badge-u1"><span class="badge-icon">ğŸ’§</span>Water Master</div>
                <div class="badge" id="badge-u2"><span class="badge-icon">ğŸ“±</span>Tech Guru</div>
                <div class="badge" id="badge-u3"><span class="badge-icon">ğŸ§ </span>Curious Soul</div>
                <div class="badge" id="badge-u4"><span class="badge-icon">â³</span>Time Traveler</div>
                <div class="badge" id="badge-u5"><span class="badge-icon">ğŸ¤</span>Team Leader</div>
                <div class="badge" id="badge-u6"><span class="badge-icon">ğŸš€</span>Futurist</div>
                <div class="badge" id="badge-1000xp"><span class="badge-icon">âš¡</span>XP Hunter</div>
                <div class="badge" id="badge-combo"><span class="badge-icon">ğŸ”¥</span>Combo King</div>
            </div>
            
            <div style="margin-top:40px; text-align:center;">
                <button onclick="resetProgress()" style="padding:10px 20px; border-radius:8px; border:1px solid var(--error); background:transparent; color:var(--error); cursor:pointer;">é‡ç½®è¿›åº¦ (Reset Save)</button>
            </div>
        </div>

    </div>
</div>

<script>
    // --- 1. DATA (Simplified for Code Length, contains full logic structure) ---
    // In a real scenario, this would be the full JSON list. I'm adding a robust subset here.
    const fullDB = [
        // U1
        {u:1, t:"proposal", d:"å»ºè®®; æè®®"}, {u:1, t:"at present", d:"ç°åœ¨ï¼Œç›®å‰"}, 
        {u:1, t:"make use of", d:"åˆ©ç”¨; ä½¿ç”¨"}, {u:1, t:"run out of", d:"ç”¨å®Œ; è€—å°½"},
        {u:1, t:"the more... the more...", d:"è¶Š...å°±è¶Š..."}, {u:1, t:"supply sb. with", d:"ç»™æŸäººæä¾›"},
        {u:1, t:"be important to", d:"å¯¹...å¾ˆé‡è¦"}, {u:1, t:"take in", d:"æ‘„å…¥; å¸æ”¶"},
        {u:1, t:"right away", d:"ç«‹åˆ»; é©¬ä¸Š"}, {u:1, t:"salty", d:"å’¸çš„"},
        // U2
        {u:2, t:"influence", d:"å½±å“"}, {u:2, t:"complain", d:"æŠ±æ€¨"},
        {u:2, t:"recognition", d:"è¯†åˆ«; æ‰¿è®¤"}, {u:2, t:"advantage", d:"ä¼˜åŠ¿; ä¼˜ç‚¹"},
        {u:2, t:"freeze", d:"å†»ç»“; æ­»æœº"}, {u:2, t:"inform", d:"é€šçŸ¥"},
        {u:2, t:"as soon as", d:"ä¸€...å°±..."}, {u:2, t:"virus", d:"ç—…æ¯’"},
        {u:2, t:"tablet", d:"å¹³æ¿ç”µè„‘"}, {u:2, t:"in conclusion", d:"æ€»è€Œè¨€ä¹‹"},
        // U3
        {u:3, t:"curious", d:"å¥½å¥‡çš„"}, {u:3, t:"familiar", d:"ç†Ÿæ‚‰çš„"},
        {u:3, t:"result in", d:"å¯¼è‡´"}, {u:3, t:"turn out", d:"ç»“æœæ˜¯; è¯æ˜æ˜¯"},
        {u:3, t:"lead to", d:"å¯¼è‡´"}, {u:3, t:"wonder", d:"æƒ³çŸ¥é“; å¥‡è¿¹"},
        {u:3, t:"now and then", d:"æœ‰æ—¶; å¶å°”"}, {u:3, t:"be related to", d:"ä¸...æœ‰å…³"},
        // U4
        {u:4, t:"decade", d:"åå¹´"}, {u:4, t:"wealthy", d:"å¯Œæœ‰çš„"},
        {u:4, t:"belong to", d:"å±äº"}, {u:4, t:"except", d:"é™¤...ä¹‹å¤–"},
        {u:4, t:"make progress", d:"å–å¾—è¿›æ­¥"}, {u:4, t:"not...any more", d:"ä¸å†"},
        {u:4, t:"in person", d:"äº²è‡ª"}, {u:4, t:"bring to life", d:"èµ‹äºˆç”Ÿå‘½; ä½¿ç”ŸåŠ¨"},
        // U5
        {u:5, t:"let sb down", d:"è®©æŸäººå¤±æœ›"}, {u:5, t:"cooperate", d:"åˆä½œ"},
        {u:5, t:"take turns", d:"è½®æµ"}, {u:5, t:"disappoint", d:"ä½¿å¤±æœ›"},
        {u:5, t:"help out", d:"å¸®å¿™è§£å†³å›°éš¾"}, {u:5, t:"in a row", d:"è¿ç»­"},
        {u:5, t:"get along with", d:"ä¸...ç›¸å¤„"}, {u:5, t:"passion", d:"çƒ­æƒ…"},
        // U6
        {u:6, t:"come true", d:"å®ç°"}, {u:6, t:"be able to", d:"èƒ½å¤Ÿ"},
        {u:6, t:"instead of", d:"ä»£æ›¿; è€Œä¸æ˜¯"}, {u:6, t:"unless", d:"é™¤é"},
        {u:6, t:"likely", d:"å¯èƒ½çš„"}, {u:6, t:"figure out", d:"å¼„æ‡‚; è®¡ç®—"},
        {u:6, t:"risk", d:"å†’...é™©"}, {u:6, t:"prevent...from", d:"é˜»æ­¢...åš..."}
    ];

    // --- 2. STATE MANAGEMENT ---
    let userState = {
        xp: 0,
        level: 1,
        mastery: {}, // { "term": 0-100 }
        unlockedBadges: []
    };

    let gameState = {
        currentUnit: 1,
        queue: [],
        currentIndex: 0,
        combo: 0,
        isAnswered: false
    };

    // Load from LocalStorage
    function loadState() {
        const saved = localStorage.getItem('aiwind_eng_save');
        if (saved) {
            userState = JSON.parse(saved);
        }
        updateUI();
    }

    function saveState() {
        localStorage.setItem('aiwind_eng_save', JSON.stringify(userState));
        updateUI();
    }

    function updateUI() {
        // XP & Level
        document.getElementById('displayXP').innerText = userState.xp + " XP";
        userState.level = Math.floor(userState.xp / 100) + 1;
        document.getElementById('displayLevel').innerText = "Lv." + userState.level;
        document.getElementById('profileLevel').innerText = "Lv." + userState.level;

        // Progress Bars (Simulated Logic)
        const totalItems = fullDB.length;
        const masteredItems = Object.keys(userState.mastery).length;
        const totalPct = Math.min(100, Math.floor((masteredItems / totalItems) * 100));
        document.getElementById('overallProgress').style.width = totalPct + "%";

        // Unit Progress
        for(let i=1; i<=6; i++) {
            const unitItems = fullDB.filter(x => x.u == i).length;
            const unitMastered = fullDB.filter(x => x.u == i && userState.mastery[x.t] >= 1).length;
            const pct = unitItems === 0 ? 0 : Math.floor((unitMastered/unitItems)*100);
            const el = document.getElementById('prog-'+i);
            if(el) el.style.width = pct + "%";
            
            // Badge Unlock Logic
            if(pct >= 90) unlockBadge('badge-u'+i);
        }

        if(userState.xp >= 1000) unlockBadge('badge-1000xp');
        
        // Badges Visual
        document.querySelectorAll('.badge').forEach(el => {
            if(userState.unlockedBadges.includes(el.id)) el.classList.add('unlocked');
        });
    }

    function unlockBadge(id) {
        if(!userState.unlockedBadges.includes(id)) {
            userState.unlockedBadges.push(id);
            alert("ğŸ… æˆå°±è§£é”! New Badge Unlocked!"); // Simple alert, can be fancy
            saveState();
        }
    }

    // --- 3. GAME LOGIC ---
    function switchView(viewName) {
        document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
        document.getElementById('view-'+viewName).classList.add('active');
        
        document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
        // Find nav item by index/logic (simplified here)
        if(viewName === 'dashboard') document.querySelectorAll('.nav-item')[0].classList.add('active');
        if(viewName === 'game') document.querySelectorAll('.nav-item')[1].classList.add('active');
        if(viewName === 'profile') document.querySelectorAll('.nav-item')[2].classList.add('active');
    }

    function startGame(unit) {
        gameState.currentUnit = unit;
        gameState.combo = 0;
        
        // Filter Data
        let pool = [];
        if (unit === 'all') pool = [...fullDB];
        else pool = fullDB.filter(item => item.u == unit);

        // Shuffle
        pool.sort(() => Math.random() - 0.5);
        gameState.queue = pool;
        gameState.currentIndex = 0;

        if(pool.length === 0) {
            alert("è¯¥å•å…ƒæš‚æ— æ•°æ®");
            return;
        }

        switchView('game');
        document.getElementById('gameUnitLabel').innerText = unit === 'all' ? "TOTAL REVIEW" : "UNIT " + unit;
        document.getElementById('qTotal').innerText = pool.length;
        loadQuestion();
    }

    function loadQuestion() {
        if (gameState.currentIndex >= gameState.queue.length) {
            finishGame();
            return;
        }

        gameState.isAnswered = false;
        const currentItem = gameState.queue[gameState.currentIndex];
        document.getElementById('qCurrent').innerText = gameState.currentIndex + 1;

        // Determine Mode: English -> Chinese OR Chinese -> English
        const mode = Math.random() > 0.5 ? 'en_cn' : 'cn_en';
        
        if(mode === 'en_cn') {
            document.getElementById('questionText').innerText = currentItem.t;
        } else {
            document.getElementById('questionText').innerText = currentItem.d;
        }

        // Generate Options
        let options = [currentItem];
        while(options.length < 4) {
            const r = fullDB[Math.floor(Math.random() * fullDB.length)];
            if(!options.includes(r)) options.push(r);
        }
        options.sort(() => Math.random() - 0.5);

        const grid = document.getElementById('optionsGrid');
        grid.innerHTML = '';

        options.forEach(opt => {
            const btn = document.createElement('div');
            btn.className = 'option-btn';
            btn.innerText = mode === 'en_cn' ? opt.d : opt.t;
            btn.onclick = (e) => handleAnswer(opt, currentItem, btn, e);
            grid.appendChild(btn);
        });
    }

    function handleAnswer(selected, correct, btnElem, event) {
        if(gameState.isAnswered) return;
        gameState.isAnswered = true;

        if (selected === correct) {
            // Correct
            btnElem.classList.add('correct');
            spawnParticles(event.clientX, event.clientY);
            
            // Logic
            userState.xp += 10 + (gameState.combo * 2);
            gameState.combo++;
            userState.mastery[correct.t] = 1; // Mark as mastered
            
            // Combo Visual
            const comboBadge = document.getElementById('comboBadge');
            if(gameState.combo >= 2) {
                comboBadge.innerText = `COMBO x${gameState.combo}!`;
                comboBadge.style.opacity = 1;
                if(gameState.combo >= 5) unlockBadge('badge-combo');
            }

            setTimeout(() => {
                comboBadge.style.opacity = 0;
                gameState.currentIndex++;
                saveState();
                loadQuestion();
            }, 800);

        } else {
            // Wrong
            btnElem.classList.add('wrong');
            gameState.combo = 0;
            
            // Highlight correct
            const allBtns = document.querySelectorAll('.option-btn');
            allBtns.forEach(b => {
                // Determine text to match
                const correctText = (document.getElementById('questionText').innerText === correct.t) ? correct.d : correct.t; 
                // Note: Simple text check might fail if duplicates exist, but okay for prototype
                if(b.innerText === correctText) b.classList.add('correct');
            });

            setTimeout(() => {
                // If wrong, push to end of queue to review again? 
                // For now, just next question to keep flow fast
                gameState.currentIndex++;
                loadQuestion();
            }, 1500);
        }
    }

    function finishGame() {
        alert("ğŸ‰ æŒ‘æˆ˜å®Œæˆ! Unit Complete!\nè·å¾—ç»éªŒå€¼: " + (gameState.queue.length * 10));
        switchView('dashboard');
    }

    function resetProgress() {
        if(confirm("ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰è¿›åº¦å—ï¼Ÿ")) {
            userState = { xp: 0, level: 1, mastery: {}, unlockedBadges: [] };
            saveState();
        }
    }

    // --- 4. VISUAL EFFECTS ---
    function spawnParticles(x, y) {
        for(let i=0; i<8; i++) {
            const p = document.createElement('div');
            p.className = 'particle';
            p.style.left = x + 'px';
            p.style.top = y + 'px';
            p.style.background = `hsl(${Math.random()*360}, 100%, 50%)`;
            p.style.width = (5 + Math.random()*5) + 'px';
            p.style.height = p.style.width;
            p.style.borderRadius = '50%';
            
            const destX = (Math.random() - 0.5) * 100;
            const destY = (Math.random() - 0.5) * 100;
            
            p.style.setProperty('--x', destX + 'px');
            p.style.setProperty('--y', destY + 'px');
            
            document.body.appendChild(p);
            setTimeout(() => p.remove(), 800);
        }
    }

    // Init
    loadState();
</script>
</body>
</html>